***Оригинал статьи:*** https://medium.freecodecamp.com/understanding-asynchronous-javascript-callbacks-through-household-chores-e3de9a1dbd04#.s6e4vtxtx

# Понимаем асинхронные обратные вызовы в Javascript с помощью списка домашних дел

### Если вы когда-нибудь стирали, то вы поймете как работают обратные вызовы (callbacks).

На днях я прочитал блестящую, веселую и легкую для понимания статью [Кевина Кононенко](https://medium.com/@kevink) про MVC-фреймворки. Он объясняет парадигму Модель-Представление-Контроллер (MVC) через заказ напитков в баре и это было одно из лучших объяснений в программировании!

Я действительно оценил эту статью, потому что она была написана без налёта элитизма. Это заставило меня задаться таким вопросом: "Почему многие опытные программисты не могут помочь новичкам без высокомерного отношения?".

В данный момент я преподаю английский язык в Северной Корее, и мы, учителя, должны думать как Кевин всё время. Сегодня крайне неодобрителен подход подробного объяснения грамматических концепций, поэтому хорошие учителя стараются преподавать языки в прямом контексте (т.е. грамматику или словарный запас вы хотели бы учить) с помощью историй, фильмов, музыки и картинок.

Эта методология преподавания находилась под влиянием британских лингвистов в 80-е годы. На ней была обоснована педагогика современного иностранного языка на данный момент. Возможно, то же самое происходит прямо сейчас для программного образования!

Кевин объясняет настолько прекрасно, что его уровень недосягаем и мои объяснения не сравнятся с его, но я всё равно хотел бы объяснить как работают асинхронные функции обратного вызова в Javascript с помощью выполнения обычных домашних дел.

## Синхронный список дел для любимого

Скажем спасибо моей жене, которая выполняла двойную работу по дому, пока я писал код. Теперь я должен ей много времени!

Обычно я помогаю по дому в воскресенье, и её список дел для меня выглядит так:

1. Постирай бельё
2. Искупай собаку
3. Отсортируй мусор
4. Сбалансируй бюджет
5. Подумай что нам приготовить на ужин

**Техническая сторона:** по сути, Javascript — это синхронный язык программирования, т.е. он работает с одной строкой кода одновременно. Он не может перейти к следующей строке кода, пока не будет выполнена текущая строка. Рассмотрим следующий пример:

```Javascript
function syncChores() {
  console.log('Постирай белье');
  console.log('помой собаку');
  console.log('отсортируй мусор');
}
syncChores();
/* Результат отображается в том же порядке, в каком и был записан:
   Постирай белье
   помой собаку
   отсортируй мусор
*/

```

А теперь представьте если бы я выполнял свою работу синхронно в реальной жизни. Что произойдёт? Как бы это выглядело?

Если вы вернётесь к моему списку, то вы увидите, что стирка — это первый пункт. Обычно это занимает около 35 минут до окончания стирки в обычном цикле и ещё 45 минут ожидания пока постиранное высушится. Так что целых 80 минут я бы просто сидел и ничего не делал, не занимаясь другими делами, так как я синхронно жду когда закончится стирка.

Вот как это выглядит в псевдокоде:

```Javascript
function doLaundry() { // нужно постирать
  startWashCycle(); // старт цикла стирки
  switchToDryer(); // переключаемся на сушку
  foldAndIronClothes(); // собираю и утюжу бельё
}
function washDog() {
  // вообразите какой-либо код моющий собаку
}
function sortRecycling() {
  // здесь тоже вообразите код сортирующий мусор
}
doLaundry(); // Стираем

// Теперь мы сидим и ждём целых 80 минут прежде чем начать делать другие функции
// ...
// Теперь я могу наконец вымыть свою собаку!

washDog(); // мою собаку
sortRecycling(); // сортирую мусор

```

Не очень продуктивно, правда? В реальной жизни взрослые люди слишком заняты, чтобы так тратить своё время, поэтому они будут заниматься всеми делами асинхронно. Они начнут со стирки и продолжат делать другие задачи из списка, и вернутся к стирке только после того, как она завершится.

Это действие возвращения обратно к стирке, когда она будет выполнена, аналогично функциям обратного вызова (callback function) в Javascript, и наша стиральная машинка, в буквальном смысле, вызовет нас назад со звонком или гудком. Это позволяет нам пойти и заняться другими домашними делами, а затем продолжить стирку когда она будет выполнена.

###  Асинхронный список дел для любимого

Давайте снова попробуем выполнить наши дела, но теперь сделаем это асинхронно. Вот как это выглядит в псевдокоде:

```Javascript

function doLaundry(callback) {
  // вообразите код который начинает цикл стирки
  // требуется 80 минут чтобы завершить цикл стирки
  callback(err, cleanLaundry);
}
doLaundry(function(err, cleanLaundry) {
  // иногда наша стиральная машина ломается
  // лучше обработайте эту возможную ошибку
  if (err) throw err;
  // если нет никакой ошибки, то переключаемся на сушку белья после того, как постиралось бельё
  // Tada! Наш обратный звонок(вызов) оповестит нас когда стирка завершится!

  switchToDryer(cleanLaundry);
});
// Пока мы ждём, JavaScript может выполнить это дело сейчас!
washDog();
// ещё осталось время для других дел!
sortRecycling();
// Следующий пункт будет неопределён(undefined) потому что он ещё не выполнен
console.log(cleanLaundry);
// Теперь стирка выполнена!
// Давайте вернёмся назад и переключимся на сушку белья
// Бельё высушено. Давайте продолжим выполнять другие наши дела.
// Таня будет впечатлена моей производительностью!
balanceBudget();

```

Как и статья Кевина, эта статья только проясняет понятие обратных вызовов. Если вы хотите большего практического руководства, прочтите [Ад обратных вызовов.](https://github.com/CubiZm/articles/tree/master/callbacks-hell)

### Ваша очередь

Эта статья поможет вам, если вы сможете применить абстрактные концепции в реальных ситуациях. Вы можете подумать о том, что вы делаете дома, в школе или на работе и это напоминало бы синхронный и асинхронный код? Напишите это в комментариях ниже!
